### 원본 영상

https://www.youtube.com/watch?v=DHPeeEvDbdo

## 목차

1. Django MVC 프로젝트에 점진적으로 React를 도입한 방법
2. 마이크로 프론트엔드 아키텍처를 도입한 이유와 후기
3. 프론트엔드 빌드 시간을 효과적으로 단축한 방법

### React가 필요했던 이유

토스 인터널이라는 사내 프로그램이 받아야 하는 사용자의 입력도 많고 점점 인터랙티브한 동작이나 기능들이 늘어감에 따라 Django(이하 장고)와 jQuery만으로 이를 해결하기 힘든 상황에 직면

### Create React App

- 선택은 CRA로 했지만 장기적인 관점에서 빌드 설정을 직접 바닥부터 만드는 것이 여러모로 이득
- 완전한 SPA가 아니고 장고를 같이 사용해야 했기 때문에 CRA의 모든 설정이 베스트는 아니었음
- 장고와의 혼용이었기에 빌드된 결과물을 장고 템플릿에 쉽게 삽입하기 위해 추가적인 라이브러리 사용
  - react-app-rewired: CRA를 eject하지 않고도 각종 설정을 수정
  - webpack-bundle-tracker: 번들의 경로와 pubilc path 추출
  - django-webpack-loader: 번들을 Jinja 템플릿에 쉽게 삽입하기 위해 사용

### 의존성 지옥

- 토스 인터널 내에 25개의 서비스가 모두 리액트로 전환
- 문제는 의존성 관리
  - 코드를 하나도 공유하지 않는 A, B 프로젝트에서 동일한 패키지를 사용하고 있는 상황
  - A에서 사용하고 있는 X라는 패키지의 버그가 있어서 B의 프로젝트에서 X라는 패키지를 패치하는 순간 의도하지 않은 빌드 실패나 버그가 A에서 발생
- 25개의 서비스에 해당하는 프로젝트들이 하나의 의존성 아래에 놓이게 되면서 빠르게 변화는 프론트엔드 생태계에 대응하기 어려워지는 문제도 발생

### 길어진 빌드 시간

- A 서비스 프로젝트의 코드를 한 줄만 수정해도 나머지 프로젝트를 전부 새로 빌드하기 때문에 빌드 시간이 너무나도 길어지는 현상이 발생
- 프로덕션 빌드 시간을 떠나서 개발 모드에서 조차 너무 많은 양의 코드를 가지고 돌아가고 있다 보니 변경한 개발 사항을 개발자가 보기 위해서 수 초 이상 기다리는 상황도 발생

## Micro-frontend Architecture

### 1. 기존의 거대한 소스 코드를 독립적인 패키지들로 분리

- **인프라 패키지**: 동일한 빌드 툴링을 공유하기 위한 패키지
- **라이브러리 패키지**: 공통 소스 코드를 관리하기 위한 패키지
- **서비스 패키지**: 페이지에서 독립적으로 작동하는 패키지

### 2. 어떻게 구현했나요?

- 최초 구현: Yarn Workspace + Lerna
- 현재 구현: Yarn 2 Workspace Plugin

### 3. 이렇게 하면 뭐가 좋나요?

- 패키지별로 독립적인 의존성을 갖게 되면서 의존성 문제를 해결
- 코드의 변경이 갖는 영향의 범위를 패키지별로 강력하게 격리
- 가장 큰 장점은 이러한 개발 구조가 토스팀에게 아주 적합했다는 점

## 빌드 시간을 줄이는 가장 좋은 방법은?

**바로 빌드 자체를 하지 않는 것**

소스 코드가 바뀐 패키지만 빌드하고 나머지는 기존 빌드 결과물을 재사용 - `incremental build`

- Git commit의 해시값을 이용하여 각 파일이 변경되었는지를 파악
- 변경된 파일만 다시 빌드하고 나머지는 기존 빌드 결과물을 활용
- yarn zero install과 유사한 방식으로 최신 빌드 사항을 Github에 같이 저장하고 pull을 받는 순간 최신 빌드를 같이 내려받는 구조
- 같이 내려받은 빌드 파일과 비교하여 코드의 변경이 발견된 곳만 다시 빌드
